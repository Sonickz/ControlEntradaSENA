{% extends 'layouts/layout.html'%}
{% load static %}

{% block title %} {{title}} {% endblock %}

{% block content %}

{% if not users %}
<article id="ingreso" class="card-scan">
    <!-- Alerta  -->
    <div class="Alert d-none" data-status="{% if messages %}{% for message in messages %}{{message}}{% endfor %}{% endif %}"></div>

    <!-- Card escaneo -->
    <section class="card">
        <header class="card-header">
            <h1 class="card-title">Escanea tu carnet</h1>
        </header>
        <div class="card-body">
            <div class="card-barra"></div>
            <div class="card-code">
                <img src="{% static 'assets/icons/carnet1.png' %}" alt="Codigo">                
            </div>                
        </div>
        <div class="card-footer">
            <form method="get" id="code-form">
                <input id="code-input" class="form-control onlynumbers" type="text" name="code" maxlength="10" minlength="6" autocomplete="off" autofocus required>
            </form>
            <!-- Boton enter -->
            <button class="btn btn-green" type="button" id="btn-send">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16">
                    <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
                </svg>
            </button>                               
        </div>
    </section>
</article>

{% else %}
<article id="module2" class="card-select-elements">
    <header>
        <h1 class="header-title">
            {% if not salida %}
                Ingreso
            {% elif salida %}
                Salida
            {% endif %}
        </h1>        
    </header>

    <!-- Alerta  -->
    <div class="Alert d-none" data-status="{% if messages %}{% for message in messages %}{{message}}{% endfor %}{% endif %}"></div>
    
    <section class="card">
        <header class="card-header">            
            <button class="btn back-button" role="button">
                <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-arrow-left-circle" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/>
                  </svg>
            </button>
            <h1 class="card-title">{{users}}</h1>
            <div class="card-header-element">
                <!-- Boton registro dispositivo -->
                <a class="btn btn-primary" title="Registrar dispositivo" href="{% url 'registerdevice' code=users.documento %}{% if ingreso %}?doc=True{% endif %}" role="button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" fill="currentColor" class="bi bi-laptop" viewBox="0 0 16 16">
                        <path d="M13.5 3a.5.5 0 0 1 .5.5V11H2V3.5a.5.5 0 0 1 .5-.5h11zm-11-1A1.5 1.5 0 0 0 1 3.5V12h14V3.5A1.5 1.5 0 0 0 13.5 2h-11zM0 12.5h16a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 12.5z"/>
                      </svg>
                </a>
                {% if not salida %}
                <!-- Boton registro vehiculo-->
                <a class="btn btn-primary" title="Registrar vehiculo" href="{% url 'registervehicle' code=users.documento %}" role="button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" fill="currentColor" class="bi bi-car-front" viewBox="0 0 16 16">
                        <path d="M4 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm10 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM6 8a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2H6ZM4.862 4.276 3.906 6.19a.51.51 0 0 0 .497.731c.91-.073 2.35-.17 3.597-.17 1.247 0 2.688.097 3.597.17a.51.51 0 0 0 .497-.731l-.956-1.913A.5.5 0 0 0 10.691 4H5.309a.5.5 0 0 0-.447.276Z"/>
                        <path d="M2.52 3.515A2.5 2.5 0 0 1 4.82 2h6.362c1 0 1.904.596 2.298 1.515l.792 1.848c.075.175.21.319.38.404.5.25.855.715.965 1.262l.335 1.679c.033.161.049.325.049.49v.413c0 .814-.39 1.543-1 1.997V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.338c-1.292.048-2.745.088-4 .088s-2.708-.04-4-.088V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.892c-.61-.454-1-1.183-1-1.997v-.413a2.5 2.5 0 0 1 .049-.49l.335-1.68c.11-.546.465-1.012.964-1.261a.807.807 0 0 0 .381-.404l.792-1.848ZM4.82 3a1.5 1.5 0 0 0-1.379.91l-.792 1.847a1.8 1.8 0 0 1-.853.904.807.807 0 0 0-.43.564L1.03 8.904a1.5 1.5 0 0 0-.03.294v.413c0 .796.62 1.448 1.408 1.484 1.555.07 3.786.155 5.592.155 1.806 0 4.037-.084 5.592-.155A1.479 1.479 0 0 0 15 9.611v-.413c0-.099-.01-.197-.03-.294l-.335-1.68a.807.807 0 0 0-.43-.563 1.807 1.807 0 0 1-.853-.904l-.792-1.848A1.5 1.5 0 0 0 11.18 3H4.82Z"/>
                    </svg>
                </a>     
                {% endif %}
            </div>
        </header>
        <div class="card-body"> 
            <!-- Seleccionar vehiculos y dispositivos -->
            <div class="row w-100 select">
                <!-- Vehiculos -->
                <div class="col">
                    <img src="{% static 'assets/icons/vehicles2.png' %}">
                    <label for="names">Vehiculos</label>  
                    {% if salida %}      
                    <!-- Zona select -->                    
                        <div class="select-form vehicle">
                            <!-- Select -->
                            <div class="select-btn open">
                                <span class="btn-text">{% if salida.vehiculo %}{{salida.vehiculo}}{% else %}Ninguno{% endif %}</span>
                            </div>      
                            <!-- Item -->                
                            <input type="hidden" class="item-selected" value="{{salida.vehiculo.idvehiculo}}">
                        </div> 
                    {% else %}
                    <!-- Zona select -->  
                    <div class="select-form vehicle">
                        <!-- Select -->
                        <div class="select-btn open">
                            <span class="btn-text">Seleccionar Vehiculo</span>
                            <span class="arrow-dwn">
                                <i class="fa-solid fa-chevron-down"></i>
                            </span>
                        </div>     
                        <!-- Lista -->                   
                        <ul class="list-items">
                            {% if vehiculos %}
                                {% for vehiculo in vehiculos %}
                                <!-- Item -->
                                <li class="item item-vehicle" value="{{vehiculo.idvehiculo}}">
                                    <span class="checkbox">
                                        <i class="fa-solid fa-check check-icon"></i>
                                    </span>
                                    <span class="item-text">{{vehiculo}}</span>
                                </li>
                                {% endfor %} 
                            {% else %} 
                                <span class="item-text">Ningun vehiculo registrado</span>
                            {% endif %}                                                          
                        </ul>
                    </div>
                    {% endif %}                                                       
                </div>
                <!-- Dispositivos -->
                <div class="col">
                    <img src="{% static 'assets/icons/devices2.png' %}">
                    <label for="names">Dispositivos</label>  
                    <!-- Zona select -->                           
                    <div class="select-form device">
                        <!-- Select -->
                        <div class="select-btn open">
                            <span class="btn-text">Seleccionar Dispositivos</span>
                            <span class="arrow-dwn">
                                <i class="fa-solid fa-chevron-down"></i>
                            </span>
                        </div>      
                        <!-- Lista -->                  
                        <ul class="list-items">
                            {% if dispositivos %}
                                {% for dispositivo in dispositivos %}
                                <!-- Item -->
                                <li class="item item-device" value="{{dispositivo.iddispositivo}}">
                                    <span class="checkbox">
                                        <i class="fa-solid fa-check check-icon"></i>
                                    </span>
                                    <span class="item-text">{{dispositivo}}</span>
                                </li>
                                {% endfor %}
                            {% else %} 
                                <span class="item-text">Ningun dispositivo registrado</span>
                            {% endif %}                                       
                        </ul>
                    </div>                                             
                </div>
            </div>         
        </div>
        <footer class="card-footer">
            <div class="row w-100 text-center">
            <!-- Boton ingresar y form para enviar el vehiculo y los dispositivos --> 
            <div class="col-lg col-md col-sm col-xs-12 ">
                <form id="form-access" method="get" action="">
                    {% csrf_token %}
                    <input id="vehicle" type="hidden" name="vehicle" value="{% if salida %}{{salida.vehiculo.idvehiculo}}{% endif %}">
                    <input id="devices" type="hidden" name="devices" value="">      
                    <button type="submit" class="btn accept">{% if salida %}Salir{% else %}Ingresar{% endif %}</button>
                </form> 
            </div>                          
        </footer>

        </div>
    </section>
</article>
{% endif %}

{% endblock %}